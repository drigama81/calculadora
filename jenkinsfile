pipeline
{
    agent {
        label "mvn"
    }
    parameters
    {
        // Tem que se ir ao Jenkins > Configure > This project is parameterized. 
        string(name: 'DOCKER_IMAGE_NAME', defaultValue: 'Image_name', description: 'Docker image name')
        //string(name: 'DOCKER_CONTAINER_NAME', defaultValue: 'container_name', description: 'Docker container name')
        //string(name: 'DOCKER_PORT', defaultValue: '3000', description: 'Docker port')
    }

 
     stages
    {
 
        stage('Create Docker Image') {
            steps {
                sh 'docker build -t "$IMAGE_NAME" .'
            }
        }

        stage('Push Image to Nexus') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'nexus-docker', passwordVariable: 'PW', usernameVariable: 'Username')]) {
                sh 'docker login -u "$Username" -p "$PW" localhost:8082'
                sh 'docker tag "$IMAGE_NAME" localhost:8082/"$IMAGE_NAME"'
                sh 'docker push localhost:8082/"$IMAGE_NAME"'
            }
        }
    }

         stage("store artifact on Nexus") {
            steps{
               withCredentials([usernameColonPassword(credentialsId: 'nexus-pw', variable: 'UserPw')]) {
                 sh 'curl -v -u "$UserPw" --upload-file upload-file /var/lib/jenkins/workspace/java-calculator-nexus/calculator.jar http://nexus:8081/repository/my-raw/'
                }
        }
    }
        // Apaga os dados do workspace.
        stage('Stage D - Clean up resources')
        {
            steps
            {
                cleanWs()
            }
        }
        
    }
}